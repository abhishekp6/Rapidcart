{% extends 'shop/basic.html' %}

{% block title %}Tracker{% endblock %}

{% block body %}

<div class="container">
    <div class="col my-4">
        <h2>Track Your Order</h2>
        <h2>Enter YOur Order Id and Email</h2>
        <form method="POST" action="#" id="trackerForm">{% csrf_token %}
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="inputname">OrderID</label>
                  <input type="text" class="form-control" id="orderId" name="orderId" placeholder="Enter Your Name">
                </div>
                <div class="form-group col-md-6">
                  <label for="inputEmail">Email</label>
                  <input type="email" class="form-control" id="email" name="email" placeholder="Enter Your Email">
                </div>
                <button type="submit" class="btn btn-primary">Track Order</button>
              </div>
        <div id="items">
        </div>
    </div>
    <div class="col my-4">
        <h2>Your Order Status</h2>
        <div class="my-3">
            <ul class="list-group">

            </ul>
          </div>
       
    </div>
</div>

{% endblock %}
{%block js%}
{%load static%}
<script>
$('#trackerForm').submit(function(event){

$('#items').empty();
var formData = {
    'orderId': $('input[name=orderId]').val(),
    'email': $('input[name=email]').val(),
    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
};

$.ajax({
    type:'POST',
    url: '/shop/tracker/',
    data: formData,
    encode: true
})

.done(function(data){
    console.log(data)
    updates = JSON.parse(data);
    if(updates.length>0 & updates!={})
    {
        for(i=0;i<updates.length;i++){
            var text = updates[i]['text'];
            var time = updates[i]['time'];
            mystr = `<li class="list-group-item d-flex justify-content-between align-items-center">
                    ${text}
                    <span class="badge badge-primary badge-pill">${time}</span>
                    </li>`
                
            $('#items').append(mystr);
                }
    }
    else{
        mystr = `<li class="list-group-item d-flex justify-content-between align-items-center">
                    NO items
                    </li>`
                
        $('#items').append(mystr);

    }
});
event.preventDefault();
})
 </script>
{%endblock%}


